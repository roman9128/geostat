## GESTA (рабочее название)


### Предназначение программы
Данная программа предназначена для визуализации данных, предоставленных пользователями в Excel-файлах (формат xlsx), на географической карте с привязкой к административно-территориальным единицам. Это позволяет наглядно отображать различные показатели, связанные с конкретными территориями.

### Ключевые особенности программы:
- использование уникальных идентификаторов (далее – id) для каждой административно-территориальной единицы (далее – территории), которые задаются разработчиком и строятся по одной схеме (примеры в файлах и далее),
- применение пользовательских данных путём их занесения в определённые файлы одного из наиболее распространённых форматов для таблиц (xlsx),
- данные связываются с административно-территориальными единицами с использованием id,
- отсутствие ограничений на количество вводимых пользователем данных,
- возможность локализации (перевода) программы на иные языки путём создания xlsx-файлов с переводом: переведены могут быть служебные надписи и наименования территорий,
- создание, изменение, переименование и удаление подборок территорий с отображением суммарных показателей для этих территорий (например, будет подсчитано общее население всех входящих в подборку территорий),
- поиск территорий с использованием различных фильтров (по типу территории, по наименованию (достаточно указать часть наименования), в зависимости от конкретных данных, в том числе с использованием условия больше/меньше/равно и т.д.).


### Механизм работы программы
Программа загружает данные из __шести__ файлов, каждый из которых имеет свое назначение:
1. bd.xlsx – файл, содержащий id каждой территории, её тип и id столицы территории (при наличии). Предполагается, что данный файл будет закрыт для редактирования пользователем,
2. nd.xlsx – файл, содержащий числовую информацию о территории, т.е., например, сведения о населении, площади, количестве магазинов – о чём угодно, что можно отобразить одним числом и обозначить заголовком. Используется тип данных Long. Предполагается, что данный файл будет открыт для наполнения пользователем,
3. td.xlsx – файл, содержащий текстовую информацию о территории. Также предполагается, что данный файл будет открыт для наполнения пользователем,
4. language.txt – файл, содержащий запись о языке интерфейса программы. Предполагается, что данный файл будет закрыт от пользователя (подробнее о языке – далее),
5. ***names.xlsx – файл, содержащий наименования территорий на выбранном пользователем языке. Предполагается, что данный файл будет открыт для редактирования пользователем,
6. ***text.xlsx – файл, содержащий служебные надписи, выводимые пользователю, на выбранном языке. Предполагается, что данный файл будет открыт для редактирования пользователем.

*(В качестве *** подставляется обозначение языка)*

Данные из xlsx-файла считываются построчно с помощью специальной библиотеки для работы с такими файлами (Apache POI).

По мере считывания строк таблицы из файла № 1 создаются объекты класса Territory, которые помещаются во временное хранилище для вновь загружаемых данных в виде объекта класса Map, в котором для хранения территорий используется HashMap (выбор HashMap обусловлен скоростью и удобством нахождения объекта по ключу, которым является id территории).

При создании объектов класса Territory подгружается информация об их наименовании из файла № 5 исходя из выбранного пользователем языка.

После загрузки указанных данных из файлов № 1 и № 5 и создания всех возможных объектов класса Territory происходит упорядочивание территорий: 
- каждой территории устанавливается определённый уровень,
- для каждой территории создаётся HashMap для информации о столице, при наличии соответствующих объектов класса Territory они помещаются в этот HashMap,
- для каждой территории определяются её структурные единицы, «подчинённые территории», информация о которых заносится в отдельный HashMap.

Далее поочерёдно загружаются данные из файлов № 2 и № 3 и заносятся в соответствующие объекты класса Territory. По завершении загрузки данных все созданные объекты класса Territory переносятся из временного хранилища в отдельный объект класса Map, предназначенный для использования этих данных.

*То есть для создания объектов класса Territory и наполнения их необходимыми данными используются одни объекты класса Map, а для использования этих данных – другой объект класса Map.*

После загрузки всей информации становится возможным взаимодействие с картой и находящимися на ней территориями.

### Локализация выводимого текста
В программе предусмотрена возможность выбора пользователем языка, которая реализована следующим образом:
- информация о выбранном языке при первом запуске программы будет записана в файл № 4 (language.txt). По умолчанию используется русский язык (запись в файл предназначена для сохранения выбора языка при последующем использовании программы),
- после считывания информации о языке из файла № 4 она передаётся в объект класса CommonLocalizator (далее – локализатор), который использует её для выбора нужных файлов с локализацией,
- информация из локализатора вызывается с помощью **статических** методов во избежание необходимости создания объектов соответствующего класса, что обусловлено потребностью в получении локализованного текста в нескольких местах программы.

*В связи с выбранным подходом следует обращать внимание на наименования файлов. Ошибка в наименовании приведёт к невозможности выбора программой нужного файла, что, однако, не помешает программе запуститься – будет использован русский язык по умолчанию, если же не будет обнаружен файл с русским языком, то программа запустится без локализации с использованием id территорий и служебных надписей.*

### Текущее состояние программы:
- написана внутренняя логика работы,
- требуется создание графического интерфейса (рассматривается Swing или JavaFX),
- предполагается, что программа будет реализована в виде Desktop-версии, не web-приложения.

### Ответы на возможные вопросы:
#### 1. Типы административно-территориальных единиц
В настоящее время добавлены только имеющиеся в России, но программа может быть легко расширена с учётом особенностей иных стран.
#### 2. Привязка территорий к географической карте
Предполагается производить её по id, для каждого экземпляра класса Territory в рамках графического интерфейса будет создан объект с таким же id.

#### 3. Структура xlsx-файлов
Файлы с таблицами должны быть упорядочены с учётом следующего:
- в первом столбце всегда указывается id территории,
- очерёдность указания id не имеет значения,
- в остальных столбцах указываются необходимые данные,
- учитываются только данные из столбцов с заголовками, данные в столбце без заголовка игнорируются,
- если ячейка таблицы под каким-либо заголовком пуста или заполнена некорректными данными, то её значение принимается равным 0 (для числовых данных) или пустой строке (для остальных случаев).

#### 4. Формат и особенности id
Пример: **RUS_CFO_MOO** для обозначения Московской области, где:
- RUS указывает, что соответствующая территория находится в России,
- CFO обозначает, что она отнесена к Центральному федеральному округу,
- MOO ссылается непосредственно на Московскую область.

Такой подход позволяет обеспечить уникальность и одновременно с этим некоторую понятность id.

*Использование трёхбуквенных сокращений и нижнего подчёркивания в качестве разделителя обязательно. Без этого программа не сможет определить id.*

Кроме того, id используется для определения уровня территории в иерархии территориальных единиц: количество трёхбуквенных сокращений, разделённых нижним подчёркиванием, соответствует уровню. В указанном примере у Московской области будет уровень 3.
В рамках программы считается, что чем меньше число, тем выше уровень.

#### 5. Файл language.txt
Обычный текстовый файл, где записана одна строка с обозначением языка. Данная строка подставляется в наименование искомого файла с локализацией. Теоретически можно использовать любые записи, главное, чтобы они потом были обнаружены в наименованиях нужных файлов. Рекомендуется использовать трёхбуквенные сокращения.

